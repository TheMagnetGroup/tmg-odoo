<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <act_window id="action_open_sale_line_delivery_wizard"
            name="Sale Line Delivery Wizard"
            src_model="sale.order.line"
            res_model="sale.order.line.delivery.wizard"
            target="new"
            view_mode="form"
            view_id="wizard_import_addtional_deliveries"
            multi="False"
            context="{}"/>


        <record id="view_sale_order_line_delivery_tree" model="ir.ui.view">
            <field name="name">sale_order_line_delivery_tree</field>
            <field name="model">sale.order.line.delivery</field>
            <field name="arch" type="xml">
                <tree editable="bottom">
                    <!--<field name="display_name" invisible="1"/>-->
                    <!--<field name="sale_line_id"/>-->
                    <field name="shipping_partner_id" attrs="{'required': 1}"/>
                    <field name="qty"/>
                </tree>
            </field>
        </record>

        <!--<record id="action_view_sale_line_delivery" model="ir.actions.act_window">-->
            <!--<field name="name">Sale Line Delivery</field>-->
            <!--<field name="res_model">sale.order.line.delivery</field>-->
            <!--<field name="view_type">form</field>-->
            <!--<field name="domain">[('sale_line_id', '=', active_id)]</field>-->
            <!--<field name="target">new</field>-->
        <!--</record>-->

        <!--<menuitem id="menu_sale_line_delivery"-->
                  <!--name="Sale Order Line Delivery"-->
                  <!--action="action_view_sale_line_delivery"-->
                  <!--parent="sale.sale_order_menu"-->
                  <!--sequence="6"-->
                  <!--groups="sales_team.group_sale_salesman"-->
                  <!--active="0"-->
        <!--/>-->

        <record id="view_sale_view_order_form_inherit_tmg" model="ir.ui.view">
            <field name="name">sale_view_order_form_inherit_tmg</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
	      <xpath expr="//button[@name='action_confirm']" position="after">
		<field name="delivery_update_ok" invisible="1"/>
		 <button name="action_update_delivery" string="UPDATE DELIVERIES" type="object" attrs="{'invisible': [('delivery_update_ok', '=', False)]}"/>
	      </xpath>
	      
	      <xpath expr="//field[@name='partner_shipping_id']" position="attributes">
		<attribute name="context">{'default_type': 'delivery', 'default_customer': False}</attribute>
	      </xpath>

                <xpath expr="//form[1]/sheet[1]/notebook[1]/page[@name='order_lines']/field[@name='order_line']/form[1]" position="inside">
                    <notebook>
                        <page name="delivery_ids" string="Shipping">
                            <div attrs="{'invisible':['|', ('display_type', '=', 'line_section'), ('display_type', '=', 'line_note')]}">
                        <div class="mt8">
                            <!-- <label for="delivery_ids"/>  this label is redundant because it repeats text already existing in the column label for shipping_partner_id -->
                            <button name="%(action_open_sale_line_delivery_wizard)d" type="action" string="Upload File" class="btn-sm btn-primary" style="float:right;"/>
                            <button name="action_unlink_all_additional_delivery_addresses" type="object" string="Remove All" confirm="This will delete all the additional addresses for this sale order line, confirm?" class="btn-sm btn-secondary" attrs="{'invisible': ['|', ('delivery_ids', '=', False), ('parent.state', 'in', ('sale', 'done'))]}" style="float:right;"/>
                        </div>
                        <field name="delivery_ids" mode="tree" editable="bottom" context="{'default_sale_line_id': active_id}">
                            <tree editable="bottom">
                                <field name="shipping_partner_id" attrs="{'required': 1}"/>
                                <field name="qty"/>
                            </tree>
                        </field>
                    </div>

                        </page>
                    </notebook>

                </xpath>
                <!--<xpath expr="//form[1]/sheet[1]/notebook[1]/page[@name='order_lines']/field[@name='order_line']/tree[1]" position="inside">-->
                    <!--<field name="delivery_ids" readonly="0"/>-->
                    <!--<field name="delivery_qty_sum"/>-->
                <!--</xpath>-->
            </field>
        </record>
    </data>
</odoo>
