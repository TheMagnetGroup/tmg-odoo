<odoo>

    <record id="tmg_proofing_proof_view_tree" model="ir.ui.view">
		<field name="name">tmg.sale.proofing.view.tree</field>
		<field name="model">sale.tmg_proofing</field>
		<field name="arch" type="xml">
			<tree string="Proofs">
				<field name="id"/>
                <field name="sale_order"/>
                <field name="original_date"/>
				<field name="state"/>
                <field name="processed"/>
                <field name="proof_response_date"/>

			</tree>
		</field>
	</record>
    <act_window id="action_open_send_proof_wizard"
            name="Sale Line Proof Wizard"
            src_model="sale.order.line"
            res_model="sale.order.line.send.proof.wizard"
            target="new"
            view_mode="form"
            view_id="wizard_create_proof"
            multi="False"
            context="{}"
            />

    <record id="tmg_proof_view_search" model="ir.ui.view">
            <field name="name">tmg.sale.proof.view.search</field>
            <field name="model">sale.tmg_proofing</field>
            <field name="arch" type="xml">
                <search>

                    <field name="id"/>
                    <field name="sale_order"/>

                    <filter string="Unprocessed Proofs" name="todo_jobs" domain="[('state', '!=', 'pending'),('processed', '=', False)]"/>
                    <filter string="Processed Proofs" name="done_jobs" domain="[('state', '!=', 'pending'),('processed', '=', True)]"/>
                <group expand="1" string="Group By">
                    <filter string="Original Date" name='groupby_orig_date' context="{'group_by':'original_date'}"/>
                    <filter string="Response Date" name='groupby_resp_date' context="{'group_by':'proof_response_date'}"/>
                    <filter string="Last Updated Date" name='groupby_updt_date' context="{'group_by':'write_date'}"/>
                    <filter string="State" name="groupby_state" context="{'group_by': 'state'}"/>
                </group>
                </search>
            </field>
        </record>
    <record id="tmg_proofing_proof_action" model="ir.actions.act_window">
      <field name="name">Proofing</field>
      <field name="res_model">sale.tmg_proofing</field>
      <field name="view_type">form</field>
      <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="tmg_proof_view_search"/>

   </record>

        <menuitem id="menu_tmg_proof_settings" name="Proofs"
                action="tmg_proofing_proof_action"
                parent="sale.sale_order_menu" sequence="70" />


	<record id="view_sale_view_order_form_inherit_proofing" model="ir.ui.view">
            <field name="name">sale_view_order_form_inherit_proofing</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="tmg_sale_stock.view_sale_view_order_form_inherit_tmg"/>
            <field name="arch" type="xml">




                <xpath expr="//page[@name='order_lines']//field[@name='order_line']/form[1]//page[@name='delivery_ids']" position="after">
                <page name="proofing_lines" string="Proofing">
                    <div>
<!--						<h3>Proofing</h3>-->
						<button name="%(action_open_send_proof_wizard)d" type="action" string="Create Proof" class="btn-sm btn-primary" />
						<field name ="proofing_lines" mode="tree">
							<tree string="Proofs" default_order="original_date">
								<field name="original_date"/>
								<field name="state"/>
                                <field name="proof_response_date"/>
							</tree>
						</field>
                    </div>
                </page>

                </xpath>

            </field>
        </record>


      <record id="tmg_proofing_form" model="ir.ui.view">
		<field name="name">tmg.proofing.form</field>
		<field name="model">sale.tmg_proofing</field>
		<field name="arch" type="xml">
			<form string="Proofing">
				<header>
<!--					<button name="send_proof" type="object" string="Send Proof" attrs="{'invisible': [('state', '!=', 'pending')]}"/>-->
                    <button name="mark_processed" type="object" string="Mark Processed" attrs="{'invisible':['|', ('state', '=', 'pending'), ('processed', '=', True)]}"/>
					<field name="state" widget="statusbar"/>
				</header>
                <sheet>
				<group>
<!--                    <field name="id" readonly='1'/>-->
                    <field name="sale_line" readonly="1"/>
                    <field name="sale_order" readonly="1"/>
                    <field name="email_ids" widget="many2many_tags_email" context="{'force_email':True,'show_email':True}"/>
                    <field name="proofing_link" readonly="1" widget="url"/>
                    <field name="original_date" readonly="1"/>
                    <field name="art_file"/>
                    <field name="notes" widget="html" readonly="1"/>
                    <field name="processed" readonly="1"/>
                    <field name="proof_response_date" readonly="1"/>
                    <field name="suggested_layout" readonly="1"/>
                    <field name="suggested_layout_accepted" readonly="1"/>
				</group>
                </sheet>
			</form>
		</field>
	</record>

        <record model="ir.ui.view" id="tmg_proofing_view_search">
            <field name="name">tmg.proofing.so.search</field>
            <field name="model">sale.tmg_proofing</field>
            <field name="arch" type="xml">
                <search string="Proof Search">
                    <field name="sale_order" string="Sale Order"/>
                </search>
            </field>
        </record>

    <record id="proofing_to_so_act" model="ir.actions.act_window">
      <field name="name">Proofs</field>
      <field name="res_model">sale.tmg_proofing</field>
      <field name="view_type">form</field>
      <field name="view_mode">tree,form,graph</field>
      <field name="search_view_id" ref="tmg_proofing_view_search"/>
      <field name="domain">[('sale_order', '=' ,active_id)]</field>
<!--      <field name="context">{'default_sale_line_order_id': active_id}</field>-->
    </record>

    <record id="tmg_order_form_inherits_proofing" model="ir.ui.view">
    <field name="arch" type="xml">
    <xpath expr="//button[@name='action_view_invoice']" position="before">

        <button type="action"
                 name="%(proofing_to_so_act)d"
                class="oe_stat_button"
                attrs="{'invisible': [('proofing_count', '=', 0)]}"
                icon="fa-tasks">
            <field string="Proofs" name="proofing_count" widget="statinfo"/>
        </button>
      </xpath>
    </field>

    <field name="inherit_id" ref="sale.view_order_form"/>
    <field name="model">sale.order</field>
    <field name="name">tmg.sales.order.form</field>
    <field name="priority">30</field>
    </record>

</odoo>