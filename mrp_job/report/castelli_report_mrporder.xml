<?xml version="1.0" encoding="UTF-8"?>
<odoo>
   <data>
      <template id="mrp_job.castelli_report_mrp">
         <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
               <t t-call="web.internal_layout">
                <div class="footer">
                    <div class="row">
                        <div class="col-3">
                            <span/>
                        </div>
                        <div class="col-2 offset-2 text-center">
                            <span t-esc="o.name"/>
                        </div>
                        <div class="col-2 offset-3 text-right">

                        </div>
                    </div>
                </div>
                  <div class="page">
                     <div class="oe_structure"/>
                     <div class="row">
                        <div class="col-7">
                           <h2>
                              SO ID:
                              <span t-field="o.name"/>
                           </h2>
<!--                           <h2>-->
<!--                              <span t-field="o.name" />-->
<!--                           </h2>-->
                           <!--                             <span class="text-left">-->
                           <!--                            <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Code128', o.sale_order_id.name, 600, 100)" style="width:300px;height:50px" alt="Barcode"/>-->
                           <!--                            </span>-->
                        </div>

                        <div>
                           <span class="text-center">
                              <t t-if="o.printed_date">
                                 <h2><b>Re-Printed</b></h2>
                              </t>
                           </span>
                        </div>
                        <!--                        <div class="col-6">-->
                        <!--                        </div>-->
                        <div class="col-5">
                           <span class="text-right">
                              <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Code128', o.name, 600, 100)" style="width:300px;height:50px" alt="Barcode"/>
                           </span>
                        </div>
                     </div>
                     <!--                    <strong t-if="o.sale_order_id.partner_shipping_id == o.sale_order_id.partner_invoice_id">Invoicing and shipping address:</strong>-->
                     <strong>Customer:</strong>
                     <div t-field="o.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
                     <!--                <t t-if="o.sale_order_id.partner_shipping_id != o.sale_order_id.partner_invoice_id">-->
                     <!--                    <strong>Shipping address:</strong>-->
                     <!--                    <div t-field="o.sale_order_id.partner_shipping_id"-->
                     <!--                        t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True, "phone_icons": True}'/>-->
                     <!--                </t>-->
                     <div class="row mt32 mb32">
                        <div class="col-3">
                           <strong>Ship Date:</strong>
                           <br/>
                           <span t-field="o.commitment_date"/>
                        </div>
                        <div class="col-3">
                           <strong>In Hands Date:</strong>
                           <br/>
                           <span t-field="o.in_hands"/>
                        </div>
                        <div class="col-3">
                           <strong>Customer Ref</strong>
                           <br/>
                           <span t-field="o.client_order_ref"/>
                        </div>
                        <!--                         <div class="col-3">-->
                        <!--                            <strong>Art Ref:</strong><br/>-->
                        <!--                            <span t-field="o.art_ref"/>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-3">-->
                        <!--                            <strong>Sales Order Number</strong><br/>-->
                        <!--                            <span t-field="o.sale_order_id.name"/>-->
                        <!--                        </div>-->
                     </div>
                     <div class="row">
                        <div class="col-3">
                           <strong>Deliver To</strong>
                           <br/>
                           <span t-field="o.partner_shipping_id.name"/>
                        </div>

                     </div>
                        <div>
                           <strong>Order Notes</strong>
                           <br/>
                           <span t-field="o.order_notes"/>
                        </div>



<!--                     </div>-->
                     <div>
                        <table class="table table-sm">
                           <!--                         <t t-set="has_related" t-value="any(o.sale_order_id.order_line.filtered(lambda x: x.job_id.id != o.id))" />-->
                           <!--                             <t t-if="has_related">-->
                           <tr style="page-break-inside:avoid">
                              <th>Product</th>
                              <th>Art Ref</th>
                              <th>Quantity To Produce</th>
                           </tr>
                           <t t-foreach="o.order_line" t-as="oline">
                              <!--                                     <t t-if="oline.job_id.id != o.id">-->
                              <tr style="page-break-inside:avoid">
                                 <td>
                                    <!-- <span t-field="oline.product_id"/>-->
                                    <span t-field="oline.name"/>
                                 </td>
                                 <td>
                                    <span t-field="oline.art_ref"/>
                                 </td>
                                 <td>
                                    <span t-field="oline.product_uom_qty"/>
                                 </td>
                              </tr>
                              <!--                                     </t>-->
                           </t>
                           <!--                             </t>-->
                        </table>
                     </div>
                     <div class="row" style="page-break-before:always">
                         <div class="col-3">
                           <h2 t-field="o.name"/>
                        </div>
                        <div class="col-3">
                           <h6>Ship Date:</h6>
                           <h6 t-field="o.commitment_date"/>
                        </div>

                     </div>
               <t t-if="o.production_ids">


                <div>
                     <div>
                        <strong>
                           Pickings
                        </strong>
                     </div>
<!--                        <t t-foreach="o.production_ids" t-as="prodids">-->
<!--                           <t t-foreach="prodids.picking_ids" t-as="pickings">-->
<!--                              <t t-if="pickings.state in ['waiting', 'confirmed']">-->
                   <t t-set="has_unallocated" t-value="any(o.production_ids.filtered(lambda x: x.picking_ids.filtered(lambda x: x.state in  ['waiting', 'confirmed'])))"/>
<!--                        <t t-set="has_unallocated" t-value="any(prodids.picking_ids.filtered(lambda x: x.state == 'waiting'))"/>-->
                        <t t-if="has_unallocated">
                              <div>

                                 <h2>*** Allocated Inventory Less Than Ordered ***</h2>
                              </div>
<!--                              <t t-esc="prodids"/>-->
<!--                           </t>-->
<!--                           </t>-->
                        </t>




                     <table class="table table-sm">
                        <tr>
                           <th>MO</th>
                           <th>Item</th>
                           <th>Qty</th>
                           <th>Qty Done</th>
                           <th>Barcode</th>
                        </tr>
                        <t t-foreach="o.production_ids" t-as="prodids">
                           <t t-foreach="prodids.picking_ids" t-as="pickings">
                              <t t-if="pickings.state != 'cancel'">
                                 <t t-foreach="pickings.move_ids_without_package" t-as="pick">
                                    <tr>
                                       <td><span t-field="prodids.name"/> </td>
                                       <td><span t-field="pick.product_id.display_name"/> </td>
                                       <td><span t-field="pick.product_uom_qty"/> </td>
                                       <td><span t-field="pick.quantity_done"/> </td>
                                       <td><img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Code128', pickings.name, 600, 100)" style="width:300px;height:50px" alt="Barcode"/></td>
                                    </tr>
                                    <tr>
                                       <td></td>
                                      <td colspan="2">
                                        <table class="table table-sm">
                                          <tr>
                                            <td>Source</td>
                                            <td>Dest</td>
                                            <td>Qty</td>
                                            <td>Qty Done</td>
                                          </tr>
                                          <t t-foreach="pick.move_line_ids" t-as="pickline">
                                            <tr>
                                              <td><span t-field="pickline.location_id.display_name"/></td>
                                              <td><span t-field="pickline.location_dest_id.display_name"/></td>
                                              <td><span t-field="pickline.product_uom_qty"/></td>
                                              <td><span t-field="pickline.qty_done"/></td>
                                            </tr>
                                          </t>
                                        </table>
                                      </td>
                                    </tr>
                                 </t>
                              </t>
                           </t>
                        </t>
                     </table>
                      </div>

                     <h2 t-field="o.name" style="page-break-before:always"/>
                      <div >
                     <div t-foreach="o.production_ids" t-as="mfg" style="border:1px solid black;">
                        <t t-if="mfg.state != 'cancel'">
                        <div class="row">
                           <div class="col-7">
                              <h3>
                                 <span t-field="mfg.name"/>
                              </h3>
                           </div>

                           <div class="col-5">
                              <span class="text-right">
                                 <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Code128', mfg.name, 600, 100)" style="width:300px;height:50px" alt="Barcode"/>
                              </span>
                           </div>
                        </div>
                           <div class="row">
                              <div class="col-5">
                              <h3>Deadline Start</h3>

                              <h5>
                                 <span t-field="mfg.date_planned_start"/>
                              </h5>
                           </div>
                           </div>
                        <table class="table table-sm" style="page-break-inside:avoid">
                           <tr>
                              <th>
                                 <strong>Item</strong>
                              </th>
                              <th>
                                 <strong>Description</strong>
                              </th>
                              <th>
                                 <strong>Quantity</strong>
                              </th>
                              <th>
                                 <strong>Quantity Produced</strong>
                              </th>
                           </tr>
                           <tr style="page-break-inside:avoid">
                              <td>
                                 <span t-field="mfg.product_id"/>
                              </td>
                              <td>
                                 <span t-field="mfg.sale_line_description"/>
                              </td>
                              <td>
                                 <span t-field="mfg.product_qty"/>
                              </td>
                              <td>
                                 <span t-field="mfg.qty_produced"/>
                              </td>
                           </tr>
                        </table>
                        <div t-if="mfg.workorder_ids">
                           <h3>
                              <t t-if="mfg.state == 'done'">Operations Done</t>
                              <t t-else="">Operations Planned</t>
                           </h3>
                           <table class="table table-sm">
                              <tr>
                                 <th>
                                    <strong>Operation</strong>
                                 </th>
                                 <th>
                                    <strong>WorkCenter</strong>
                                 </th>
                                 <th>
                                    <strong>Nmfg. Of Minutes</strong>
                                 </th>
                              </tr>
                              <tr t-foreach="mfg.workorder_ids" t-as="line2">
                                 <td>
                                    <span t-field="line2.name"/>
                                 </td>
                                 <td>
                                    <span t-field="line2.workcenter_id.name"/>
                                 </td>
                                 <td>
                                    <span t-if="mfg.state != 'done'" t-field="line2.duration_expected"/>
                                    <span t-if="mfg.state == 'done'" t-field="line2.duration"/>
                                 </td>
                              </tr>
                           </table>
                        </div>
                        <h3 t-if="mfg.move_raw_ids">
                           <t t-if="mfg.state == 'done'">Consumed Products</t>
                           <t t-else="">Products to Consume</t>
                        </h3>
                        <table class="table table-sm" t-if="mfg.move_raw_ids" style="page-break-inside:avoid">
                           <t t-set="has_location" t-value="any(mfg.move_raw_ids.filtered(lambda x: x.move_line_ids.filtered(lambda x: x.location_id.id)))" groups="stock.group_stock_multi_locations"/>
                           <t t-set="has_serial_number" t-value="any(mfg.move_raw_ids.filtered(lambda x: x.move_line_ids.filtered(lambda x: x.lot_id or x.lot_name)))" groups="stock.group_production_lot"/>
                           <t t-set="has_product_barcode" t-value="any(mfg.move_raw_ids.filtered(lambda x: x.product_id.barcode))"/>
                           <t t-set="has_product_available" t-value="any(mfg.move_raw_ids.filtered(lambda x: x.move_line_ids.filtered(lambda x: x.product_qty)))"/>
                           <t t-if="mfg.state=='done'">
                              <t t-set="has_product_available" t-value="any(mfg.move_raw_ids.filtered(lambda x: x.move_line_ids.filtered(lambda x: x.qty_done)))"/>
                           </t>
                           <thead>
                              <tr>
                                 <th>Product</th>
                                 <th>Quantity</th>
                                 <th>
                                    <span t-if="has_location">From</span>
                                 </th>
                                 <th t-if="has_serial_number" width="15%">Lot/Serial barcode</th>
                                 <th t-if="has_product_barcode" width="15%" class="text-center">Barcode</th>
                              </tr>
                           </thead>
                           <tbody>
                              <!--                            <t t-if="has_product_available and mfg.move_raw_ids" >-->
                              <t t-set="lines" t-value="mfg.move_raw_ids"/>
                              <t t-foreach="lines" t-as="line">
                                 <t t-set="move_lines" t-value="line.move_line_ids.filtered(lambda x: x.state != 'done' and x.state != 'cancel')"/>
                                 <t t-if="mfg.state == 'done'">
                                    <t t-set="move_lines" t-value="line.move_line_ids.filtered(lambda x: x.state == 'done' and x.qty_done)"/>
                                 </t>
                                 <t t-foreach="lines" t-as="ml">
                                    <tr>
                                       <td>
                                          <span t-field="line.product_id"/>
                                       </td>
                                       <td>
                                          <!--                                                <span t-esc="ml.product_uom_qty" t-if="ml.state !='done'"/>-->
                                          <!--                                                <span t-esc="ml.qty_done"  t-if="ml.state =='done'"/>-->
                                          <span t-field="line.product_qty"/>
                                          <span t-field="ml.product_uom"/>
                                       </td>
                                       <!--                                            <td>-->
                                       <!--                                                <span t-if="has_location">-->
                                       <!--                                                    <span t-field="ml.location_id"/>-->
                                       <!--                                                </span>-->
                                       <!--                                            </td>-->
                                       <!--                                            <td t-if="has_serial_number" width="15%">-->
                                       <!--                                                <t t-if="has_serial_number and (ml.lot_id or ml.lot_name)">-->
                                       <!--                                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Code128', ml.lot_id.name, 600, 100)" style="width:100%;height:35px" alt="Barcode"/>-->
                                       <!--                                                </t>-->
                                       <!--                                            </td>-->
                                       <td t-if="has_product_barcode" width="15%" class="text-right">
                                          <t t-if="line.product_id.barcode">
                                             <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Code128', line.product_id.barcode, 600, 100)" style="width:300px;height:50px" alt="Barcode"/>
                                          </t>
                                       </td>
                                    </tr>
                                 </t>
                              </t>
                              <!--                            </t>-->
                           </tbody>
                        </table>
                        <t t-set="has_product_reserved" t-value="mfg.move_raw_ids.filtered(lambda x: x.product_uom_qty != x.reserved_availability)"/>
                        <!--                    <p t-if="mfg.state !='done' and (not has_product_available or has_product_reserved)" class="fa fa-exclamation-triangle">-->
                        <!--                        All components could not be reserved. Click on the "Check Availability button" to try to reserve components.-->
                        <!--                    </p>-->
                        <div class="oe_structure"/>
                        <!--                    <h3>Shipments</h3>-->
                        <!--                    <table  class="table table-sm">-->
                        <!--                            <tr>-->
                        <!--                                <th><strong>Address</strong></th>-->
                        <!--                                <th><strong>Ship Date</strong></th>-->
                        <!--                                <th><strong>Quantity</strong></th>-->
                        <!--                                <th></th>-->
                        <!--                            </tr>-->
                        <!--                            <tr t-foreach="mfg.move_dest_ids" t-as="ship1">-->
                        <!--                                <td><span t-field="ship1.partner_id"-->
                        <!--                t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True, "phone_icons": True}'/>-->
                        <!--                        </td>-->
                        <!--                                <td><span t-field="ship1.date_expected"/></td>-->
                        <!--                                <td>-->
                        <!--                                    <span t-field="ship1.product_uom_qty"/>-->
                        <!--                                </td>-->
                        <!--                                <td><img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;humanreadable=1' %  ('Code128', ship1.reference, 605, 100)" style="width:300px;height:50px"  alt="Barcode"/></td>-->
                        <!--                            </tr>-->
                        <!--                        </table>-->
                        </t>
<!--                        End If-->
                     </div>

                      </div>
                     </t>
<!--                     <div>-->
<!--                        <h3>Shipments</h3>-->
<!--                        <table class="table table-sm">-->
<!--                           <tr>-->
<!--                              <th>-->
<!--                                 <strong>Address</strong>-->
<!--                              </th>-->
<!--                              <th>-->
<!--                                 <strong>Ship Date</strong>-->
<!--                              </th>-->
<!--                              <th>-->
<!--                                 <strong>Quantity</strong>-->
<!--                              </th>-->
<!--                              <th />-->
<!--                           </tr>-->
<!--                           <t t-foreach="o.production_ids" t-as="mfg">-->
<!--                              <tr t-foreach="mfg.move_dest_ids" t-as="ship1">-->
<!--                                 <td>-->
<!--                                    <span t-field="ship1.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;], &quot;no_marker&quot;: True}" />-->
<!--                                 </td>-->
<!--                                 <td>-->
<!--                                    <span t-field="ship1.date_expected" />-->
<!--                                 </td>-->
<!--                                 <td>-->
<!--                                    <span t-field="ship1.product_uom_qty" />-->
<!--                                 </td>-->
<!--                                 <td>-->
<!--                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;humanreadable=1' %  ('Code128', ship1.reference, 605, 100)" style="width:300px;height:50px" alt="Barcode" />-->
<!--                                 </td>-->
<!--                              </tr>-->
<!--                           </t>-->
<!--                        </table>-->
<!--                     </div>-->
                     <h2 t-field="o.name" style="page-break-before:always"/>
                     <div style="border:thin">
                        <h3>Shipments</h3>

                        <t t-foreach="o.picking_ids" t-as="ship1">
                           <t t-if="ship1.state != 'cancel'">
                           <div style="border:1px solid black">
<!--                              <t t-foreach="mfg.move_dest_ids" t-as="ship1">-->
                                 <div class="row mt32 mb32" style="page-break-inside:avoid">
                                    <div class="col-3">
                                       <strong>Address:</strong>
                                       <br/>
                                       <span t-field="ship1.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;attention_to&quot;, &quot;name&quot;], &quot;no_marker&quot;: True}"/>
                                    </div>
                                    <div class="col-3">
                                       <strong>Ship Date:</strong>
                                       <br/>
                                        <span t-field="ship1.scheduled_date"/>
                                    </div>
                                    <div class="col-3">
                                       <strong>Ship Method:</strong>
                                       <br/>
                                       <span t-field="ship1.carrier_id.name"/>
                                          <br/>
                                       <span><img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;humanreadable=1' %  ('Code128', ship1.name, 605, 100)" style="width:300px;height:50px" alt="Barcode"/> </span>

                                    </div>
<!--                                    <div class="col-3">-->
<!--                                       <strong>Barcode:</strong>-->
<!--                                       <br />-->
<!--                                       <span> <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;humanreadable=1' %  ('Code128', ship1.name, 605, 100)" style="width:300px;height:50px" alt="Barcode" /> </span>-->
<!--                                    </div>-->
                                 </div>
<!--                              <div class="row mt32 mb32" >-->

                              <div class="row" style="margin-left:15px;max-width:100%">
                                 <div style="max-width:100%;align:center;left-margin:16px">
                                 <table style="align:center;width:800px">
                                    <tr>
                                       <th style="width=90px">Product</th>
                                       <th>Quantity</th>
                                       <th style="text-align:right">Quantity Done</th>
<!--                                       <t t-if="not ship1.move_orig_ids">-->
                                          <th style="text-align:right">Location</th>
<!--                                       </t>-->
                                    </tr>
                                    <t t-foreach="ship1.move_ids_without_package" t-as="prod">
                                       <tr>
                                          <td><span t-field="prod.product_id.display_name"/></td>
                                          <td><span t-field="prod.product_uom_qty"/></td>
                                          <td style="text-align:right"><span t-field="prod.quantity_done"/></td>
                                          <t t-if="not prod.move_orig_ids">
                                          <td style="text-align:right"><span t-field="prod.location_id"/></td>
                                       </t>
                                       </tr>
                                    </t>
                                 </table>
                                 </div>
                                 <div style="max-width:30%; align:right">

                                 </div>
<!--                                 </div>-->
                                 </div>
                           </div>

<!--                           End if-->
                              </t>
                              </t>
<!--                        </t>-->
                     </div>
                     <div t-foreach="o.attachment_ids" t-as="atts">
                        <t t-foreach="atts.attachment_category" t-as="cats">
                           <t t-if="cats.name == 'Production Art'">
                              <img t-attf-src="data:image/*;base64,{{atts.datas}}"/>
                              <!--                                <span t-field="atts.datas" t-field-options='{"widget": "image"}'/>-->
                           </t>
                        </t>
                     </div>
                     <div class="oe_structure"/>
                  </div>
               </t>
            </t>
         </t>
      </template>
   </data>
</odoo>